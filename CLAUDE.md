# CLAUDE.md

## 工作流编排

### 1. 默认进入计划模式
- 任何非简单任务（3步以上或涉及架构决策）都要先进入计划模式
- 出现问题时，立即停下来重新规划，不要硬撑
- 计划模式不只用于构建，也用于验证步骤
- 提前写好详细规范，减少歧义

### 2. 子代理策略
- 大量使用子代理，保持主上下文窗口干净
- 将研究、探索和并行分析任务分发给子代理
- 复杂问题通过子代理投入更多算力
- 每个子代理只专注一个任务

### 3. 自我改进循环
- 每次被用户纠正后：将该模式记录到 `tasks/lessons.md`
- 为自己写下规则，防止重蹈覆辙
- 不断迭代这些经验，直到错误率下降
- 每次会话开始时回顾相关项目的经验记录

### 4. 完成前必须验证
- 不经验证不标记任务完成
- 必要时对比主版本与修改版的行为差异
- 问自己："高级工程师会认可这个方案吗？"
- 跑测试、查日志、证明正确性

### 5. 追求优雅（保持平衡）
- 非简单修改时，停下来问："有没有更优雅的方案？"
- 如果感觉是个临时凑合的方案，就说："基于我所知道的一切，去实现那个优雅的解法"
- 简单明显的修改跳过这步，不要过度设计
- 提交前先挑战自己的成果

### 6. 自主修复 Bug
- 收到 Bug 报告时：直接修，不需要被手把手指导
- 定位日志、报错、失败测试，然后解决
- 不需要用户切换上下文配合
- 自己去修复失败的 CI 测试

---

## 任务管理

1. **先写计划**：将可勾选的任务项写入 `tasks/todo.md`
2. **确认计划**：开始实现前先检查确认
3. **追踪进度**：随时勾选已完成项
4. **解释变更**：每一步提供高层级摘要
5. **记录结果**：在 `tasks/todo.md` 中添加回顾章节
6. **沉淀经验**：被纠正后更新 `tasks/lessons.md`

---

## 核心原则

- **简单优先**：每次改动尽可能简单，影响代码最小化
- **不走捷径**：找根本原因，不用临时方案，对标高级工程师标准
- **最小影响**：改动只触碰必要的地方，避免引入新 Bug
